function initialize(){function r(n){for(var t=0;t<n.length;t++)$(n[t]).removeClass(),$(n[t]).addClass("btn btn-default")}function u(n){var i=$(timeLogForm),u=$(timeLogInput),r=$(timeLogEditButton);i.append(u);i.append(r);t(r);n.append(i)}function t(n){$(n).unbind();$(n).on("click",function(){var n=$(this).closest("tr").find("form.time-log");f(n)})}function f(n){var t=n.find("input.time-input");t.removeAttr("readonly");$(t).focus();var u=t.val(),f=$(timeLogOkButton),r=$(timeLogCancelButton);$(r).on("click",function(){var t=$(this).closest("tr").find("form.time-log"),n=$(this).closest("tr").find("input.time-input");n.attr("readonly","readonly");n.val(u);i(t)});n.unbind();n.submit(function(n){var t=$(this);n.preventDefault();var r=$(t).closest("tr").data("eventid"),u=$(t).closest("tr").data("squadid"),f=$(t).closest("tr").data("playerid"),e=$(t).find("input.time-input").val();$.ajax({method:"POST",contentType:"application/json",url:"/api/events/timelog",data:JSON.stringify({eventid:r,squadid:u,playerid:f,timelogged:e})}).done(function(){i(t)}).fail(function(n,t){console.log(t)})});n.append(f);n.append(r);n.find("button.editTimeLog").remove()}function i(n){var r=n.find("input.time-input"),i;r.attr("readonly","readonly");i=$(timeLogEditButton);n.append(i);t(i);n.find("button.saveTimeLog").remove();n.find("button.cancelTimeLog").remove()}var n=null;$("button.editFeedback").tooltip({placement:"auto left",trigger:"hover"});$("button.editFeedback").click(function(){var t=$(this);n=t;var i=t.closest("tr").find("td:nth-child("+columns.player+")").text(),r=t.closest("tr").data("eventid"),u=t.closest("tr").data("squadid"),f=t.closest("tr").data("playerid"),e=t.attr("data-original-title");$("form.feedback textarea").val(e);t.tooltip("hide");$("#feedbackDialog h4").text("Feedback - "+i);$("#feedbackDialog").data("eventid",r);$("#feedbackDialog").data("squadid",u);$("#feedbackDialog").data("playerid",f);$("#feedbackDialog").modal("show")});$("form.feedback").submit(function(t){t.preventDefault();var r=$("#feedbackDialog").data("eventid"),u=$("#feedbackDialog").data("squadid"),f=$("#feedbackDialog").data("playerid"),i=$("form.feedback textarea").val();$.ajax({method:"POST",contentType:"application/json",url:"/api/events/feedback",data:JSON.stringify({eventid:r,squadid:u,playerid:f,feedback:i})}).done(function(){$("#feedbackDialog h4").text("Feedback");$("#feedbackDialog").data("eventid",null);$("#feedbackDialog").data("squadid",null);$("#feedbackDialog").data("playerid",null);$("#feedbackDialog").modal("hide");$.trim(i).length==0?(n.find("span.glyphicon").addClass("text-muted"),n.removeAttr("data-original-title")):(n.find("span.glyphicon").removeClass("text-muted"),n.attr("data-original-title",i))}).fail(function(n,t){console.log(t)})});$("button.attendance").on("click",function(){var n=$(this),f=$(this).closest("tr").data("eventid"),e=$(this).closest("tr").data("squadid"),o=$(this).closest("tr").data("playerid"),s=$(this).closest("tr").data("attendanceid"),t=n.data("attendanceid"),i=s==t?attendance.unSpecified:t;$.ajax({method:"POST",contentType:"application/json",url:"/api/events/attendance",data:JSON.stringify({eventid:f,squadid:e,playerid:o,attendance:i})}).done(function(){var o=n.closest("tr").find("button.attendance"),f,e;r(o);i!=attendance.unSpecified&&(f=t==attendance.present?"btn-success":t==attendance.noShow?"btn-danger":t==attendance.late?"btn-warning":"btn-info",$(n).addClass("attendance btn "+f));i==attendance.unSpecified||i==attendance.noShow?$(n).closest("tr").find("form.time-log").remove():$(n).closest("tr").find("form.time-log").length==0&&(e=$(n).closest("tr").find("td:nth-child("+columns.timeLogged+")"),u(e));$(n).closest("tr").data("attendanceid",i)}).fail(function(n,t){console.log(t)})});t("button.editTimeLog")}var attendance={unSpecified:null,present:1,noShow:2,late:3,leftEarly:4},columns={squad:1,player:2,present:3,late:4,leftEarly:5,noShow:6,timeLogged:7},timeLogForm="<form class='time-log'><\/form>",timeLogInput="<input class='form-control time-input input-sm' type='number' min='0' max='400' maxlength='3' readonly placeholder='0'/>",timeLogOkButton="<button type='submit' class='btn btn-default btn-sm saveTimeLog' title='save'><span class='glyphicon glyphicon-ok text-success'><\/span><\/button>",timeLogCancelButton="<button type='button' class='btn btn-default btn-sm cancelTimeLog' title='cancel'><span class='glyphicon glyphicon-remove text-danger'><\/span><\/button>",timeLogEditButton="<button type='button' class='btn btn-default btn-sm editTimeLog' title='edit'><span class='glyphicon glyphicon-pencil'><\/span><\/button>";